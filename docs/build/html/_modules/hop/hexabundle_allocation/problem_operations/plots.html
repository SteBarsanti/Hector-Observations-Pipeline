<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>hop.hexabundle_allocation.problem_operations.plots &#8212; Hector Observations Pipeline 1.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css" />
    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../../../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../../../../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../../../../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../../../_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../../index.html">
          Hector Observations Pipeline</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../calculating_offsets.html">Calculating Offsets from one Hexabundle to another</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../plot_plate_configuration.html">Plotting a plate configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../show_sky_fibre_changes_between_plates.html">Showing the Sky Fibre Changes between Plates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../check_magnet_counts_between_tiles.html">Checking two plates can be observed after each other</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../prepare_files_for_robot.html">Preparing files to be configured by the robot</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <h1>Source code for hop.hexabundle_allocation.problem_operations.plots</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">patches</span>
<span class="kn">from</span> <span class="nn">matplotlib.transforms</span> <span class="kn">import</span> <span class="n">Affine2D</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>
<span class="kn">from</span> <span class="nn">..hector.magnets.circular</span> <span class="kn">import</span> <span class="n">is_circular_magnet</span>
<span class="kn">from</span> <span class="nn">..hector.magnets.rectangular</span> <span class="kn">import</span> <span class="n">is_rectangular_magnet</span>
<span class="kn">from</span> <span class="nn">..hector.constants</span> <span class="kn">import</span> <span class="n">robot_center_x</span><span class="p">,</span><span class="n">robot_center_y</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">pi</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">sin</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">..general_operations.trigonometry</span> <span class="kn">import</span> <span class="n">rotational_matrix</span><span class="p">,</span><span class="n">convert_degrees_to_radians</span><span class="p">,</span> <span class="n">convert_radians_to_degrees</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">string</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>          <span class="c1"># controls default text sizes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="n">titlesize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>     <span class="c1"># fontsize of the axes title</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>     <span class="c1"># fontsize of the x and y labels</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;xtick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>    <span class="c1"># fontsize of the tick labels</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;ytick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>    <span class="c1"># fontsize of the tick labels</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;legend&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>    <span class="c1"># legend fontsize</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;figure&#39;</span><span class="p">,</span> <span class="n">titlesize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>   <span class="c1"># fontsize of the figure title</span>

<span class="c1"># creating annotated text on the magnets to differentiate the type and size of hexabundles used and for labels</span>
<div class="viewcode-block" id="annotate_text_in_plot"><a class="viewcode-back" href="../../../../hop.hexabundle_allocation.problem_operations.html#hop.hexabundle_allocation.problem_operations.plots.annotate_text_in_plot">[docs]</a><span class="k">def</span> <span class="nf">annotate_text_in_plot</span><span class="p">(</span><span class="n">magnet</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
    <span class="n">rotation_matrix</span> <span class="o">=</span> <span class="n">rotational_matrix</span><span class="p">(</span><span class="n">convert_degrees_to_radians</span><span class="p">(</span><span class="n">magnet</span><span class="o">.</span><span class="n">plot_orientation</span><span class="p">))</span>
    
    
    <span class="k">if</span> <span class="n">magnet</span><span class="o">.</span><span class="n">hexabundle</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span> <span class="ow">or</span> <span class="n">magnet</span><span class="o">.</span><span class="n">hexabundle</span> <span class="o">==</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span>
        <span class="n">corner_offset</span> <span class="o">=</span> <span class="mi">9</span>
        <span class="n">width</span> <span class="o">=</span> <span class="mf">22.4</span>
        <span class="n">length</span> <span class="o">=</span> <span class="mf">54.4</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="mi">14</span>
        <span class="n">z_order</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">elif</span> <span class="n">magnet</span><span class="o">.</span><span class="n">hexabundle</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
        <span class="n">corner_offset</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="n">width</span> <span class="o">=</span> <span class="mf">19.4</span>
        <span class="n">length</span> <span class="o">=</span> <span class="mf">51.4</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="mi">12</span>
        <span class="n">z_order</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">elif</span> <span class="n">magnet</span><span class="o">.</span><span class="n">hexabundle</span> <span class="o">==</span> <span class="s1">&#39;H&#39;</span> <span class="ow">or</span> <span class="n">magnet</span><span class="o">.</span><span class="n">hexabundle</span> <span class="o">==</span> <span class="s1">&#39;U&#39;</span><span class="p">:</span>
        <span class="n">corner_offset</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">width</span> <span class="o">=</span> <span class="mf">13.4</span>
        <span class="n">length</span> <span class="o">=</span> <span class="mf">45.4</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="mi">9</span>
        <span class="n">z_order</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">corner_offset</span> <span class="o">=</span> <span class="mf">3.5</span>
        <span class="n">width</span> <span class="o">=</span> <span class="mf">16.4</span>
        <span class="n">length</span> <span class="o">=</span> <span class="mf">48.4</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">z_order</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="n">magnet</span><span class="o">.</span><span class="n">corner</span> <span class="o">=</span> <span class="p">(</span><span class="n">magnet</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rotation_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">magnet</span><span class="o">.</span><span class="n">width</span> <span class="o">+</span> <span class="n">corner_offset</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">rotation_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">magnet</span><span class="o">.</span><span class="n">length</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> \
                    <span class="n">magnet</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">rotation_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">magnet</span><span class="o">.</span><span class="n">width</span> <span class="o">+</span> <span class="n">corner_offset</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">rotation_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">magnet</span><span class="o">.</span><span class="n">length</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">magnet</span><span class="o">.</span><span class="n">circular_center</span> <span class="o">=</span> <span class="p">(</span><span class="n">magnet</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">rotation_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">magnet</span><span class="o">.</span><span class="n">length</span> <span class="o">+</span> <span class="mi">27</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> \
                             <span class="n">magnet</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">rotation_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">magnet</span><span class="o">.</span><span class="n">length</span> <span class="o">+</span> <span class="mi">27</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">annotated_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(\d+)&#39;</span><span class="p">,</span> <span class="n">magnet</span><span class="o">.</span><span class="n">magnet_label</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">annotated_text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">magnet</span><span class="o">.</span><span class="n">hexabundle</span> <span class="o">+</span> <span class="s1">&#39;  &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">annotated_text</span><span class="p">))</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">annotated_text</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;S&#39;</span><span class="p">):</span>
        <span class="n">annotated_text</span> <span class="o">=</span> <span class="n">annotated_text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;GS&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">label_color</span> <span class="o">=</span> <span class="s1">&#39;yellow&#39;</span><span class="c1"># change back to &#39;yellow&#39;</span>
        <span class="n">patch_color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="o">&gt;</span> <span class="n">magnet</span><span class="o">.</span><span class="n">hexabundle</span> <span class="o">&gt;=</span><span class="s1">&#39;A&#39;</span><span class="p">):</span>
        <span class="n">label_color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>
        <span class="n">patch_color</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">magnet</span><span class="o">.</span><span class="n">hexabundle</span> <span class="o">&gt;</span><span class="s1">&#39;H&#39;</span><span class="p">):</span>
        <span class="n">label_color</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span><span class="c1"># change back to &#39;white&#39;</span>
        <span class="n">patch_color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>

    <span class="c1"># Increase zorder of the smaller hexabundles over A and B and C- the largest ones</span>
    <span class="c1"># ****** previousOne draw_fill = patches.Rectangle((magnet.corner[0], magnet.corner[1]), width, length, angle=abs(180 - magnet.plot_orientation),facecolor=patch_color,alpha=0.8,zorder=3)#,edgecolor=&#39;black&#39;,linewidth=0.5</span>
    <span class="n">draw_fill2</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">magnet</span><span class="o">.</span><span class="n">corner</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">magnet</span><span class="o">.</span><span class="n">corner</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">width</span><span class="p">,</span> <span class="p">(</span><span class="n">length</span><span class="o">-</span><span class="mi">12</span><span class="p">),</span> <span class="n">angle</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="mi">180</span> <span class="o">-</span> <span class="n">magnet</span><span class="o">.</span><span class="n">plot_orientation</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">patch_color</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="n">z_order</span><span class="p">)</span>
    <span class="n">draw_fill3</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">magnet</span><span class="o">.</span><span class="n">circular_center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">magnet</span><span class="o">.</span><span class="n">circular_center</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">patch_color</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="n">z_order</span><span class="p">)</span>
    <span class="n">draw_fill4</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">magnet</span><span class="o">.</span><span class="n">corner</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">magnet</span><span class="o">.</span><span class="n">corner</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">width</span><span class="p">,</span> <span class="p">(</span><span class="n">length</span> <span class="o">-</span> <span class="mi">11</span><span class="p">),</span> <span class="n">angle</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="mi">180</span> <span class="o">-</span> <span class="n">magnet</span><span class="o">.</span><span class="n">plot_orientation</span><span class="p">),</span>
                                   <span class="n">facecolor</span><span class="o">=</span><span class="n">patch_color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="c1"># ax.add_artist(draw_fill) ## previous one</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">draw_fill2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">draw_fill3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">draw_fill4</span><span class="p">)</span>

    <span class="n">magnet</span><span class="o">.</span><span class="n">text_center</span> <span class="o">=</span> <span class="p">(</span><span class="n">magnet</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">rotation_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">magnet</span><span class="o">.</span><span class="n">length</span> <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> \
                    <span class="n">magnet</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">rotation_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">magnet</span><span class="o">.</span><span class="n">length</span> <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>


    <span class="kn">import</span> <span class="nn">ipdb</span><span class="p">;</span> <span class="n">ipdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">magnet</span><span class="o">.</span><span class="n">hexabundle</span> <span class="o">==</span> <span class="s1">&#39;H&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">magnet</span><span class="o">.</span><span class="n">hexabundle</span> <span class="o">==</span> <span class="s1">&#39;U&#39;</span><span class="p">):</span>
        <span class="n">annotated_star</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;      ★&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">annotated_star</span><span class="p">,</span> <span class="p">(</span><span class="n">magnet</span><span class="o">.</span><span class="n">text_center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">magnet</span><span class="o">.</span><span class="n">text_center</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="n">label_color</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="mi">90</span> <span class="o">-</span> <span class="n">magnet</span><span class="o">.</span><span class="n">plot_orientation</span><span class="p">),</span> \
                     <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">annotated_text</span><span class="p">,</span> <span class="p">(</span><span class="n">magnet</span><span class="o">.</span><span class="n">text_center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">magnet</span><span class="o">.</span><span class="n">text_center</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="n">label_color</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="mi">90</span> <span class="o">-</span> <span class="n">magnet</span><span class="o">.</span><span class="n">plot_orientation</span><span class="p">),</span>\
                 <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="c1">#import ipdb; ipdb.set_trace()</span>
    <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="coordinates_and_angle_of_skyFibres"><a class="viewcode-back" href="../../../../hop.hexabundle_allocation.problem_operations.html#hop.hexabundle_allocation.problem_operations.plots.coordinates_and_angle_of_skyFibres">[docs]</a><span class="k">def</span> <span class="nf">coordinates_and_angle_of_skyFibres</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span><span class="n">radii</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">y</span> <span class="o">=</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">angle</span><span class="o">&gt;</span><span class="mi">180</span><span class="p">:</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">360</span><span class="o">-</span><span class="n">angle</span><span class="p">)</span>

    <span class="k">if</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">angle</span><span class="o">&lt;=</span><span class="mi">90</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">radii</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">90</span><span class="o">-</span><span class="n">angle</span><span class="p">))</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">radii</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">90</span><span class="o">-</span><span class="n">angle</span><span class="p">))</span>
        <span class="n">rotation</span> <span class="o">=</span> <span class="n">angle</span>
    <span class="k">elif</span> <span class="mi">90</span><span class="o">&lt;</span><span class="n">angle</span><span class="o">&lt;=</span><span class="mi">180</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">radii</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="o">-</span><span class="mi">90</span><span class="p">))</span>
        <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">radii</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="o">-</span><span class="mi">90</span><span class="p">))</span>
        <span class="n">rotation</span> <span class="o">=</span> <span class="n">angle</span>
    <span class="k">elif</span> <span class="o">-</span><span class="mi">90</span><span class="o">&lt;=</span><span class="n">angle</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">radii</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="o">+</span><span class="mi">90</span><span class="p">))</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">radii</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="o">+</span><span class="mi">90</span><span class="p">))</span>
        <span class="n">rotation</span> <span class="o">=</span> <span class="n">angle</span>
    <span class="k">elif</span> <span class="o">-</span><span class="mi">180</span><span class="o">&lt;=</span><span class="n">angle</span><span class="o">&lt;-</span><span class="mi">90</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">radii</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="o">+</span><span class="mi">180</span><span class="p">))</span>
        <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">radii</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="o">+</span><span class="mi">180</span><span class="p">))</span>
        <span class="n">rotation</span> <span class="o">=</span> <span class="n">angle</span>

    <span class="k">return</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">rotation</span></div>

<div class="viewcode-block" id="read_sky_fibre_file"><a class="viewcode-back" href="../../../../hop.hexabundle_allocation.problem_operations.html#hop.hexabundle_allocation.problem_operations.plots.read_sky_fibre_file">[docs]</a><span class="k">def</span> <span class="nf">read_sky_fibre_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read in a sky fibre file </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># print(skyfibreDict)</span>

    <span class="k">if</span> <span class="s2">&quot;Tile_FinalFormat&quot;</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="p">:</span>
        <span class="n">df_skyfibre</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df_skyfibre</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>

    <span class="n">mask</span> <span class="o">=</span> <span class="n">df_skyfibre</span><span class="p">[</span><span class="s1">&#39;fibre_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;S&#39;</span>
    <span class="n">df_skyfibre</span> <span class="o">=</span> <span class="n">df_skyfibre</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>

    <span class="n">skyfibreDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">subplate_info</span> <span class="o">=</span> <span class="n">df_skyfibre</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span>
    <span class="n">position</span> <span class="o">=</span> <span class="n">df_skyfibre</span><span class="p">[</span><span class="s1">&#39;SkyPosition&#39;</span><span class="p">]</span>
    <span class="n">position</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">subplate_info</span><span class="p">:</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">skyfibreDict</span><span class="p">:</span>
            <span class="n">skyfibreDict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">])]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">skyfibreDict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">])]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">7</span><span class="p">]):</span> <span class="nb">int</span><span class="p">(</span><span class="n">position</span><span class="p">[</span><span class="n">j</span><span class="p">])})</span>

        <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">skyfibreDict</span></div>


<div class="viewcode-block" id="plot_skyfibre_section"><a class="viewcode-back" href="../../../../hop.hexabundle_allocation.problem_operations.html#hop.hexabundle_allocation.problem_operations.plots.plot_skyfibre_section">[docs]</a><span class="k">def</span> <span class="nf">plot_skyfibre_section</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">skyfibreDict</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">angle_subplate</span><span class="p">,</span> <span class="n">skyfibre_titles</span><span class="p">,</span> <span class="n">delta_ang</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">colour_array</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draw the positions of one of the three Hector skyfibre subplates.</span>
<span class="sd">    There are three sections or &quot;subplates&quot; of skyfibres in Hector. Each is made up of four &quot;wedges&quot;, labelled by the spectrograph they feed (&quot;A&quot; or &quot;H&quot;) and a number. This function plots one section, corresponding to 4 wedges. </span>
<span class="sd">    In each wedge, there are a number of fibres which can be in the position 0, 1, 2,  or 3. </span>

<span class="sd">    Args:</span>
<span class="sd">        fig: A matplotlib figure object</span>
<span class="sd">        ax: A matplotlib axis object</span>
<span class="sd">        skyfibreDict (dict): A dictionary of each skyfibre wedge and its fibres.</span>
<span class="sd">        angle (float): The angle of the entire subplate</span>
<span class="sd">        radius (float): The radius at which to draw the subplates. Should be 270 mm. </span>
<span class="sd">        angle_subplate (list): The angle of each sky fibre with respect to the overall angle variable above. Should be [7,5,3,1,-1,-3,-5,-7]</span>
<span class="sd">        skyfibre_titles (list): A list of each wedge name</span>
<span class="sd">        delta_ang (float): The difference in angle between adjacent wedges.</span>
<span class="sd">        colour_array (list, optional): A list of colours to plot each sky fibre as. Useful for plots showing the changes between two plates. If None, default to black for all fibres</span>
<span class="sd">    Returns:</span>
<span class="sd">        ax</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">colour_array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">colour_array</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;black&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">skyfibreDict</span><span class="p">[</span><span class="n">s</span><span class="p">])</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">skyfibre_titles</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">title</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">skyfibre_titles</span><span class="p">):</span>
        <span class="c1"># Get the location of the place to plot the Wedge name (H1, A2, etc)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="n">coordinates_and_angle_of_skyFibres</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span><span class="n">radius</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="n">rotation</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

        <span class="n">colours</span> <span class="o">=</span> <span class="n">colour_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="c1"># Now loop through the fibres in each wedge</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">skyfibre</span><span class="p">,</span> <span class="n">colour</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">skyfibreDict</span><span class="p">[</span><span class="n">title</span><span class="p">],</span> <span class="n">colours</span><span class="p">)):</span>

            <span class="c1"># Get the angle of each individual fibre</span>
            <span class="n">angle_pos</span> <span class="o">=</span> <span class="n">angle</span> <span class="o">+</span> <span class="n">angle_subplate</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

            <span class="c1"># Get the sky fibre&#39;s number from the dictionary</span>
            <span class="n">fibre_num</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">skyfibre</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># We now want to plot a bullet at a slightly smaller radius</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="n">coordinates_and_angle_of_skyFibres</span><span class="p">(</span><span class="n">angle_pos</span><span class="p">,</span> <span class="mi">308</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;▮&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">colour</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="n">rotation</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

            <span class="c1">#And now plot the value of the skyfibre (0, 1, 2, or 3) at an inbetween radius</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="n">coordinates_and_angle_of_skyFibres</span><span class="p">(</span><span class="n">angle_pos</span><span class="p">,</span> <span class="mi">322</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">skyfibre</span><span class="p">[</span><span class="n">fibre_num</span><span class="p">],</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">colour</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="n">rotation</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

            <span class="c1"># Find its x/y coordinates at a given radius</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="n">coordinates_and_angle_of_skyFibres</span><span class="p">(</span><span class="n">angle_pos</span><span class="p">,</span> <span class="mi">342</span><span class="p">)</span>
            <span class="c1"># Add the fibre number to the plot</span>
            <span class="k">if</span> <span class="n">colour</span> <span class="o">==</span> <span class="s1">&#39;yellow&#39;</span><span class="p">:</span>
                <span class="n">colour</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">fibre_num</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">colour</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="n">rotation</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>


        <span class="c1"># Now plot the entire wedge </span>
        <span class="k">if</span> <span class="n">skyfibre_titles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.4</span>
        <span class="k">elif</span> <span class="n">skyfibre_titles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.7</span>
        <span class="n">draw_wedge</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">Wedge</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">r</span><span class="o">=</span><span class="mi">333</span><span class="p">,</span> <span class="n">theta1</span><span class="o">=</span><span class="n">angle</span><span class="o">-</span><span class="mi">9</span><span class="o">+</span><span class="mi">90</span><span class="p">,</span> <span class="n">theta2</span><span class="o">=</span><span class="n">angle</span><span class="o">+</span><span class="mi">9</span><span class="o">+</span><span class="mi">90</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">draw_wedge</span><span class="p">)</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">angle</span> <span class="o">-</span> <span class="n">delta_ang</span>
        <span class="c1">#print(f&quot;Angle is {angle}&quot;)</span>

    <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="sky_fibre_annotations"><a class="viewcode-back" href="../../../../hop.hexabundle_allocation.problem_operations.html#hop.hexabundle_allocation.problem_operations.plots.sky_fibre_annotations">[docs]</a><span class="k">def</span> <span class="nf">sky_fibre_annotations</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">skyfibre_file</span><span class="p">):</span>

    <span class="n">angle_subplate</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="o">-</span><span class="mi">7</span><span class="p">]</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="mi">270</span>

    <span class="c1"># filename = &#39;Sky_fibre_position_example.csv&#39;</span>
    <span class="n">skyfibreDict</span> <span class="o">=</span> <span class="n">read_sky_fibre_file</span><span class="p">(</span><span class="n">skyfibre_file</span><span class="p">)</span>
    <span class="c1">#print(skyfibreDict)</span>
    <span class="c1">#string = str(skyfibreDict[&#39;H3&#39;][5].keys())</span>
    <span class="c1">#print(re.sub(&#39;[^0-9]&#39;, &#39;&#39;, string))</span>

    <span class="c1">#sky fibres top batch</span>
    <span class="n">skyfibreTitles_top</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;H3&#39;</span><span class="p">,</span><span class="s1">&#39;A3&#39;</span><span class="p">,</span><span class="s1">&#39;H4&#39;</span><span class="p">,</span><span class="s1">&#39;A4&#39;</span><span class="p">]</span>
    <span class="n">skyfibreTitles_left</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A1&#39;</span><span class="p">,</span> <span class="s1">&#39;H1&#39;</span><span class="p">,</span> <span class="s1">&#39;H2&#39;</span><span class="p">,</span> <span class="s1">&#39;A2&#39;</span><span class="p">]</span>
    <span class="n">skyfibreTitles_right</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;H7&#39;</span><span class="p">,</span> <span class="s1">&#39;A5&#39;</span><span class="p">,</span> <span class="s1">&#39;H6&#39;</span><span class="p">,</span> <span class="s1">&#39;H5&#39;</span><span class="p">]</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_skyfibre_section</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">skyfibreDict</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">angle_subplate</span><span class="o">=</span><span class="n">angle_subplate</span><span class="p">,</span> <span class="n">skyfibre_titles</span><span class="o">=</span><span class="n">skyfibreTitles_top</span><span class="p">,</span> <span class="n">delta_ang</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_skyfibre_section</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">skyfibreDict</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">angle_subplate</span><span class="o">=</span><span class="n">angle_subplate</span><span class="p">,</span> <span class="n">skyfibre_titles</span><span class="o">=</span><span class="n">skyfibreTitles_left</span><span class="p">,</span> <span class="n">delta_ang</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_skyfibre_section</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">skyfibreDict</span><span class="p">,</span> <span class="n">angle</span><span class="o">=-</span><span class="mi">160</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">angle_subplate</span><span class="o">=</span><span class="n">angle_subplate</span><span class="p">,</span> <span class="n">skyfibre_titles</span><span class="o">=</span><span class="n">skyfibreTitles_right</span><span class="p">,</span> <span class="n">delta_ang</span><span class="o">=-</span><span class="mi">20</span><span class="p">)</span>

    <span class="c1"># angle = 30</span>
    <span class="c1"># for i in range(0,4):</span>
    <span class="c1">#     x, y, rotation = coordinates_and_angle_of_skyFibres(angle,radii)</span>
    <span class="c1">#     ax.annotate(skyfibreTitles_top[i], (x,y), color=&#39;black&#39;,rotation=rotation, fontsize=11, ha=&#39;center&#39;, va=&#39;center&#39;)</span>
    <span class="c1">#     for j in range(len(skyfibreDict[skyfibreTitles_top[i]])):</span>
    <span class="c1">#         angle_pos = angle + angle_subplate[j]</span>
    <span class="c1">#         x, y, rotation = coordinates_and_angle_of_skyFibres(angle_pos, 342)</span>
    <span class="c1">#         fibre_num = re.sub(&#39;[^0-9]&#39;, &#39;&#39;, str(skyfibreDict[skyfibreTitles_top[i]][j].keys()))</span>
    <span class="c1">#         ax.annotate(fibre_num, (x, y), color=&#39;black&#39;, rotation=rotation, fontsize=5,ha=&#39;center&#39;, va=&#39;center&#39;)</span>
    <span class="c1">#         x, y, rotation = coordinates_and_angle_of_skyFibres(angle_pos, 308)</span>
    <span class="c1">#         ax.annotate(&#39;▮&#39;, (x, y), color=&#39;black&#39;, rotation=rotation, fontsize=7,ha=&#39;center&#39;, va=&#39;center&#39;)</span>
    <span class="c1">#         x, y, rotation = coordinates_and_angle_of_skyFibres(angle_pos, 322)</span>
    <span class="c1">#         ax.annotate(str(skyfibreDict[skyfibreTitles_top[i]][j][j+1]), (x, y), color=&#39;black&#39;, rotation=rotation, fontsize=6, weight=&#39;bold&#39;, ha=&#39;center&#39;,va=&#39;center&#39;)</span>
    <span class="c1">#     if skyfibreTitles_top[i][0] == &#39;H&#39;:</span>
    <span class="c1">#         alpha = 0.4</span>
    <span class="c1">#     elif skyfibreTitles_top[i][0] == &#39;A&#39;:</span>
    <span class="c1">#         alpha = 0.7</span>
    <span class="c1">#     draw_wedge = patches.Wedge((0, 0), r=333, theta1=angle-9+90, theta2=angle+9+90, width=90, facecolor=&#39;gray&#39;, edgecolor=&#39;black&#39;,alpha=alpha)</span>
    <span class="c1">#     ax.add_artist(draw_wedge)</span>
    <span class="c1">#     angle = angle - 20</span>
    <span class="c1">#     print(f&quot;Angle is {angle}&quot;)</span>

    <span class="c1"># # sky fibres left batch</span>
    <span class="c1"># angle = 150</span>
    <span class="c1"># skyfibreTitles_left = [&#39;A1&#39;, &#39;H1&#39;, &#39;H2&#39;, &#39;A2&#39;]</span>
    <span class="c1"># for i in range(0, 4):</span>
    <span class="c1">#     x, y, rotation = coordinates_and_angle_of_skyFibres(angle,radii)</span>
    <span class="c1">#     ax.annotate(skyfibreTitles_left[i], (x, y), color=&#39;black&#39;, rotation=rotation, fontsize=11, ha=&#39;center&#39;, va=&#39;center&#39;)</span>
    <span class="c1">#     for j in range(len(skyfibreDict[skyfibreTitles_left[i]])):</span>
    <span class="c1">#         angle_pos = angle + angle_subplate[j]</span>
    <span class="c1">#         x, y, rotation = coordinates_and_angle_of_skyFibres(angle_pos, 342)</span>
    <span class="c1">#         fibre_num = re.sub(&#39;[^0-9]&#39;, &#39;&#39;, str(skyfibreDict[skyfibreTitles_left[i]][j].keys()))</span>
    <span class="c1">#         ax.annotate(fibre_num, (x, y), color=&#39;black&#39;, rotation=rotation, fontsize=5, ha=&#39;center&#39;,va=&#39;center&#39;)</span>
    <span class="c1">#         x, y, rotation = coordinates_and_angle_of_skyFibres(angle_pos, 308)</span>
    <span class="c1">#         ax.annotate(&#39;▮&#39;, (x, y), color=&#39;black&#39;, rotation=rotation, fontsize=7, ha=&#39;center&#39;,va=&#39;center&#39;)</span>
    <span class="c1">#         x, y, rotation = coordinates_and_angle_of_skyFibres(angle_pos, 322)</span>
    <span class="c1">#         ax.annotate(str(skyfibreDict[skyfibreTitles_left[i]][j][j + 1]), (x, y), color=&#39;black&#39;, rotation=rotation, fontsize=6, weight=&#39;bold&#39;, ha=&#39;center&#39;, va=&#39;center&#39;)</span>
    <span class="c1">#     if skyfibreTitles_left[i][0] == &#39;H&#39;:</span>
    <span class="c1">#         alpha = 0.4</span>
    <span class="c1">#     elif skyfibreTitles_left[i][0] == &#39;A&#39;:</span>
    <span class="c1">#         alpha = 0.7</span>
    <span class="c1">#     draw_wedge = patches.Wedge((0, 0), r=333, theta1=angle-9+90, theta2=angle+9+90, width=90, facecolor=&#39;gray&#39;, edgecolor=&#39;black&#39;,alpha=alpha)</span>
    <span class="c1">#     ax.add_artist(draw_wedge)</span>
    <span class="c1">#     angle = angle - 20</span>
    <span class="c1">#     print(f&quot;Angle is {angle}&quot;)</span>

    <span class="c1"># # sky fibres right batch</span>
    <span class="c1"># angle = -160</span>
    <span class="c1"># skyfibreTitles_right = [&#39;H7&#39;, &#39;A5&#39;, &#39;H6&#39;, &#39;H5&#39;]</span>
    <span class="c1"># for i in range(0, 4):</span>
    <span class="c1">#     x, y, rotation = coordinates_and_angle_of_skyFibres(angle,radii)</span>
    <span class="c1">#     ax.annotate(skyfibreTitles_right[i], (x, y), color=&#39;black&#39;, rotation=rotation, fontsize=11, ha=&#39;center&#39;, va=&#39;center&#39;)</span>
    <span class="c1">#     for j in range(len(skyfibreDict[skyfibreTitles_right[i]])):</span>
    <span class="c1">#         angle_pos = angle + angle_subplate[j]</span>
    <span class="c1">#         x, y, rotation = coordinates_and_angle_of_skyFibres(angle_pos, 342)</span>
    <span class="c1">#         fibre_num = re.sub(&#39;[^0-9]&#39;, &#39;&#39;, str(skyfibreDict[skyfibreTitles_right[i]][j].keys()))</span>
    <span class="c1">#         ax.annotate(fibre_num, (x, y), color=&#39;black&#39;, rotation=rotation, fontsize=5, ha=&#39;center&#39;,va=&#39;center&#39;)</span>
    <span class="c1">#         x, y, rotation = coordinates_and_angle_of_skyFibres(angle_pos, 308)</span>
    <span class="c1">#         ax.annotate(&#39;▮&#39;, (x, y), color=&#39;black&#39;, rotation=rotation, fontsize=7, ha=&#39;center&#39;,va=&#39;center&#39;)</span>
    <span class="c1">#         x, y, rotation = coordinates_and_angle_of_skyFibres(angle_pos, 322)</span>
    <span class="c1">#         ax.annotate(str(skyfibreDict[skyfibreTitles_right[i]][j][j + 1]), (x, y), color=&#39;black&#39;, rotation=rotation, fontsize=6, weight=&#39;bold&#39;, ha=&#39;center&#39;, va=&#39;center&#39;)</span>
    <span class="c1">#     if skyfibreTitles_right[i][0] == &#39;H&#39;:</span>
    <span class="c1">#         alpha = 0.4</span>
    <span class="c1">#     elif skyfibreTitles_right[i][0] == &#39;A&#39;:</span>
    <span class="c1">#         alpha = 0.7</span>
    <span class="c1">#     draw_wedge = patches.Wedge((0, 0), r=333, theta1=angle-9+90, theta2=angle+9+90, width=90, facecolor=&#39;gray&#39;, edgecolor=&#39;black&#39;,alpha=alpha)</span>
    <span class="c1">#     ax.add_artist(draw_wedge)</span>
    <span class="c1">#     angle = angle + 20</span>
    <span class="c1">#     print(f&quot;Angle is {angle}&quot;)</span>

    <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="draw_circularSegments"><a class="viewcode-back" href="../../../../hop.hexabundle_allocation.problem_operations.html#hop.hexabundle_allocation.problem_operations.plots.draw_circularSegments">[docs]</a><span class="k">def</span> <span class="nf">draw_circularSegments</span><span class="p">(</span><span class="n">ax</span><span class="p">):</span>

    <span class="n">draw_circle</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">226</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#E78BE7&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
    <span class="n">draw_circle1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mf">196.05124</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#f6f93b&#39;</span><span class="p">)</span>
    <span class="n">draw_circle2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mf">147.91658</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#60fb3d&#39;</span><span class="p">)</span>
    <span class="n">draw_circle3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mf">92.71721</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#add8e6&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">draw_circle</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">draw_circle1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">draw_circle2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">draw_circle3</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="draw_circular_magnet"><a class="viewcode-back" href="../../../../hop.hexabundle_allocation.problem_operations.html#hop.hexabundle_allocation.problem_operations.plots.draw_circular_magnet">[docs]</a><span class="k">def</span> <span class="nf">draw_circular_magnet</span><span class="p">(</span><span class="n">magnet</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draw the circular magnets on the Hector field plate and label them</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">text_angle</span> <span class="o">=</span> <span class="p">(</span><span class="n">magnet</span><span class="o">.</span><span class="n">angs</span> <span class="o">-</span> <span class="mi">90</span><span class="p">)</span> <span class="o">%</span> <span class="mi">90</span>

    <span class="n">text</span> <span class="o">=</span> <span class="n">magnet</span><span class="o">.</span><span class="n">hexabundle</span>
    <span class="k">if</span> <span class="s2">&quot;GS&quot;</span> <span class="ow">in</span> <span class="n">magnet</span><span class="o">.</span><span class="n">hexabundle</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">propdict</span> <span class="o">=</span> <span class="n">get_magnet_properties</span><span class="p">(</span><span class="n">magnet</span><span class="o">.</span><span class="n">hexabundle</span><span class="p">)</span>
    <span class="n">circular_magnet</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">magnet</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">magnet</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">radius</span><span class="o">=</span><span class="n">propdict</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">],</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">propdict</span><span class="p">[</span><span class="s1">&#39;patch_color&#39;</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="n">propdict</span><span class="p">[</span><span class="s1">&#39;z_order&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circular_magnet</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">magnet</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">magnet</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="n">propdict</span><span class="p">[</span><span class="s1">&#39;label_color&#39;</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="n">text_angle</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">propdict</span><span class="p">[</span><span class="s1">&#39;z_order&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="get_magnet_properties"><a class="viewcode-back" href="../../../../hop.hexabundle_allocation.problem_operations.html#hop.hexabundle_allocation.problem_operations.plots.get_magnet_properties">[docs]</a><span class="k">def</span> <span class="nf">get_magnet_properties</span><span class="p">(</span><span class="n">hexabundle</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a dictionary of useful properties for each magnet</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">hexabundle</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span> <span class="ow">or</span> <span class="n">hexabundle</span> <span class="o">==</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span>
        <span class="n">corner_offset</span> <span class="o">=</span> <span class="mi">9</span>
        <span class="n">width</span> <span class="o">=</span> <span class="mf">22.4</span>
        <span class="n">length</span> <span class="o">=</span> <span class="mf">54.4</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="mi">14</span>
        <span class="n">z_order</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">elif</span> <span class="n">hexabundle</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
        <span class="n">corner_offset</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="n">width</span> <span class="o">=</span> <span class="mf">19.4</span>
        <span class="n">length</span> <span class="o">=</span> <span class="mf">51.4</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="mi">14</span>
        <span class="n">z_order</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">elif</span> <span class="n">hexabundle</span> <span class="o">==</span> <span class="s1">&#39;H&#39;</span> <span class="ow">or</span> <span class="n">hexabundle</span> <span class="o">==</span> <span class="s1">&#39;U&#39;</span><span class="p">:</span>
        <span class="n">corner_offset</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">width</span> <span class="o">=</span> <span class="mi">17</span>
        <span class="n">length</span> <span class="o">=</span> <span class="mf">48.4</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="mi">12</span>
        <span class="n">z_order</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">corner_offset</span> <span class="o">=</span> <span class="mf">3.5</span>
        <span class="n">width</span> <span class="o">=</span> <span class="mi">17</span>
        <span class="n">length</span> <span class="o">=</span> <span class="mf">48.4</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="mi">12</span>
        <span class="n">z_order</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="k">if</span> <span class="n">hexabundle</span> <span class="ow">in</span> <span class="p">([</span><span class="s1">&#39;GS1&#39;</span><span class="p">,</span> <span class="s1">&#39;GS2&#39;</span><span class="p">,</span> <span class="s1">&#39;GS3&#39;</span><span class="p">,</span> <span class="s1">&#39;GS4&#39;</span><span class="p">,</span> <span class="s1">&#39;GS5&#39;</span><span class="p">,</span> <span class="s1">&#39;GS6&#39;</span><span class="p">]):</span>
        <span class="n">label_color</span> <span class="o">=</span> <span class="s1">&#39;yellow&#39;</span><span class="c1"># change back to &#39;yellow&#39;</span>
        <span class="n">patch_color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="o">&gt;</span> <span class="n">hexabundle</span> <span class="o">&gt;=</span><span class="s1">&#39;A&#39;</span><span class="p">):</span>
        <span class="n">label_color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>
        <span class="n">patch_color</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">hexabundle</span> <span class="o">&gt;</span><span class="s1">&#39;H&#39;</span><span class="p">):</span>
        <span class="n">label_color</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span><span class="c1"># change back to &#39;white&#39;</span>
        <span class="n">patch_color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>

    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">corner_offset</span><span class="o">=</span><span class="n">corner_offset</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">length</span><span class="p">,</span> <span class="n">z_order</span><span class="o">=</span><span class="n">z_order</span><span class="p">,</span> <span class="n">label_color</span><span class="o">=</span><span class="n">label_color</span><span class="p">,</span> <span class="n">patch_color</span><span class="o">=</span><span class="n">patch_color</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">)</span></div>

<div class="viewcode-block" id="draw_rectangular_magnet"><a class="viewcode-back" href="../../../../hop.hexabundle_allocation.problem_operations.html#hop.hexabundle_allocation.problem_operations.plots.draw_rectangular_magnet">[docs]</a><span class="k">def</span> <span class="nf">draw_rectangular_magnet</span><span class="p">(</span><span class="n">magnet</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draw a rectangular magnet on the hector plate. Annotate it with its number</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">propdict</span> <span class="o">=</span> <span class="n">get_magnet_properties</span><span class="p">(</span><span class="n">magnet</span><span class="o">.</span><span class="n">hexabundle</span><span class="p">)</span>

    <span class="n">centre</span> <span class="o">=</span> <span class="n">magnet</span><span class="o">.</span><span class="n">center</span>
    <span class="n">magnet_corner</span> <span class="o">=</span> <span class="p">(</span><span class="n">centre</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">propdict</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">centre</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">propdict</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">12</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    
    <span class="c1"># Rotate the magnet around their centres</span>
    <span class="n">transform</span> <span class="o">=</span> <span class="n">Affine2D</span><span class="p">()</span><span class="o">.</span><span class="n">rotate_deg_around</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">magnet</span><span class="o">.</span><span class="n">center</span><span class="p">),</span> <span class="mi">180</span> <span class="o">-</span> <span class="n">magnet</span><span class="o">.</span><span class="n">plot_orientation</span><span class="p">)</span><span class="o">+</span><span class="n">ax</span><span class="o">.</span><span class="n">transData</span>
    <span class="c1"># Increase zorder of the smaller hexabundles over A and B and C- the largest ones</span>
    <span class="c1"># ****** previousOne draw_fill = patches.Rectangle((magnet.corner[0], magnet.corner[1]), width, length, angle=abs(180 - magnet.plot_orientation),facecolor=patch_color,alpha=0.8,zorder=3)#,edgecolor=&#39;black&#39;,linewidth=0.5</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span><span class="n">magnet_corner</span><span class="p">,</span> <span class="n">propdict</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">],</span> <span class="n">propdict</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">propdict</span><span class="p">[</span><span class="s1">&#39;patch_color&#39;</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="n">propdict</span><span class="p">[</span><span class="s1">&#39;z_order&#39;</span><span class="p">],</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

    <span class="n">text</span> <span class="o">=</span> <span class="n">magnet</span><span class="o">.</span><span class="n">magnet_label</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">text_angle</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">magnet</span><span class="o">.</span><span class="n">angs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">90</span><span class="p">)</span> <span class="o">%</span> <span class="mi">90</span>
    <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="k">if</span> <span class="n">magnet</span><span class="o">.</span><span class="n">hexabundle</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;U&#39;</span><span class="p">]:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2"> ★&quot;</span>
        <span class="n">text_angle</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">magnet</span><span class="o">.</span><span class="n">angs</span><span class="p">)</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span>
        <span class="n">fontsize</span> <span class="o">-=</span> <span class="mi">1</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="p">(</span><span class="n">magnet</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">magnet</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="n">propdict</span><span class="p">[</span><span class="s1">&#39;label_color&#39;</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="n">text_angle</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">,</span> <span class="p">)</span>

    <span class="k">return</span> <span class="n">magnet</span><span class="p">,</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="draw_all_magnets"><a class="viewcode-back" href="../../../../hop.hexabundle_allocation.problem_operations.html#hop.hexabundle_allocation.problem_operations.plots.draw_all_magnets">[docs]</a><span class="k">def</span> <span class="nf">draw_all_magnets</span><span class="p">(</span><span class="n">magnets</span><span class="p">,</span> <span class="n">clusterNum</span><span class="p">,</span> <span class="n">fileNameHexa</span><span class="p">,</span> <span class="n">robot_figureFile</span><span class="p">,</span> <span class="n">hexabundle_figureFile</span><span class="p">,</span> <span class="n">fig_hexa</span><span class="p">,</span> <span class="n">ax_hexa</span><span class="p">,</span> <span class="n">fig_robot</span><span class="p">,</span> <span class="n">ax_robot</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make the two main plots from this code- the hexabundle plot and the robot pickup plot. For historical reasons, these are plotted at the same time in this single function rather than separately...</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ax_hexa</span> <span class="o">=</span> <span class="n">draw_circularSegments</span><span class="p">(</span><span class="n">ax_hexa</span><span class="p">)</span>
    <span class="n">ax_hexa</span> <span class="o">=</span> <span class="n">sky_fibre_annotations</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="n">fig_hexa</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_hexa</span><span class="p">,</span> <span class="n">skyfibre_file</span><span class="o">=</span><span class="n">fileNameHexa</span><span class="p">)</span>

    <span class="c1"># Get all the hexabundles</span>
    <span class="n">all_hexabundles</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span><span class="p">[:</span><span class="mi">21</span><span class="p">])</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;GS1&#39;</span><span class="p">,</span> <span class="s1">&#39;GS2&#39;</span><span class="p">,</span> <span class="s1">&#39;GS3&#39;</span><span class="p">,</span> <span class="s1">&#39;GS4&#39;</span><span class="p">,</span> <span class="s1">&#39;GS5&#39;</span><span class="p">,</span> <span class="s1">&#39;GS6&#39;</span><span class="p">]</span>

    <span class="c1"># Make a dictionary of all the circular magnets and all the rectangular ones</span>
    <span class="n">circular_magnet_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">rectangular_magnet_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">magnet</span> <span class="ow">in</span> <span class="n">magnets</span><span class="p">:</span>
        <span class="n">hexabundle</span> <span class="o">=</span> <span class="n">magnet</span><span class="o">.</span><span class="n">hexabundle</span>

        <span class="k">if</span> <span class="n">is_circular_magnet</span><span class="p">(</span><span class="n">magnet</span><span class="p">):</span>
            <span class="n">circular_magnet_dict</span><span class="p">[</span><span class="n">hexabundle</span><span class="p">]</span> <span class="o">=</span> <span class="n">magnet</span>
        <span class="k">elif</span> <span class="n">is_rectangular_magnet</span><span class="p">(</span><span class="n">magnet</span><span class="p">):</span>
            <span class="n">rectangular_magnet_dict</span><span class="p">[</span><span class="n">hexabundle</span><span class="p">]</span> <span class="o">=</span> <span class="n">magnet</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Not sure what type this magnet is!&quot;</span><span class="p">)</span>

    <span class="c1"># Add the angs values to the circular magnets</span>
    <span class="k">for</span> <span class="n">hexabundle</span> <span class="ow">in</span> <span class="n">all_hexabundles</span><span class="p">:</span>
        <span class="n">circular_magnet_dict</span><span class="p">[</span><span class="n">hexabundle</span><span class="p">]</span><span class="o">.</span><span class="n">angs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">rectangular_magnet_dict</span><span class="p">[</span><span class="n">hexabundle</span><span class="p">]</span><span class="o">.</span><span class="n">angs</span><span class="p">)</span>

    <span class="c1"># Loop through the magnets and plot one by one</span>
    <span class="k">for</span> <span class="n">magnet</span> <span class="ow">in</span> <span class="n">magnets</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">is_circular_magnet</span><span class="p">(</span><span class="n">magnet</span><span class="p">):</span>

            <span class="k">for</span> <span class="n">pickup_area</span> <span class="ow">in</span> <span class="n">magnet</span><span class="o">.</span><span class="n">pickup_areas</span><span class="p">:</span>
                <span class="n">pickup_area</span><span class="o">.</span><span class="n">draw_rectangle</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="s1">&#39;--c&#39;</span><span class="p">,</span> <span class="n">figurenum</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_robot</span><span class="p">)</span>
            <span class="n">magnet</span><span class="o">.</span><span class="n">draw_circle</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">ax1</span><span class="o">=</span><span class="n">ax_hexa</span><span class="p">,</span> <span class="n">ax2</span><span class="o">=</span><span class="n">ax_robot</span><span class="p">)</span>

            <span class="c1"># Draw the circular magnets on the hexabundle plot</span>
            <span class="n">ax_hexa</span> <span class="o">=</span> <span class="n">draw_circular_magnet</span><span class="p">(</span><span class="n">magnet</span><span class="p">,</span> <span class="n">ax_hexa</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">is_rectangular_magnet</span><span class="p">(</span><span class="n">magnet</span><span class="p">):</span>
            
            <span class="n">magnet</span><span class="p">,</span> <span class="n">ax_hexa</span> <span class="o">=</span> <span class="n">draw_rectangular_magnet</span><span class="p">(</span><span class="n">magnet</span><span class="p">,</span> <span class="n">ax_hexa</span><span class="p">)</span>

            <span class="n">ax_hexa</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;mm&#39;</span><span class="p">)</span>
            <span class="n">ax_hexa</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;mm&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">pickup_area</span> <span class="ow">in</span> <span class="n">magnet</span><span class="o">.</span><span class="n">pickup_areas</span><span class="p">:</span>
                <span class="n">pickup_area</span><span class="o">.</span><span class="n">draw_rectangle</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="s1">&#39;--c&#39;</span><span class="p">,</span> <span class="n">figurenum</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_robot</span><span class="p">)</span>
            <span class="n">magnet</span><span class="o">.</span><span class="n">draw_rectangle</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">figurenum</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_robot</span><span class="p">)</span>
            <span class="n">ax_robot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">robot_center_x</span> <span class="o">+</span> <span class="n">magnet</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">robot_center_y</span> <span class="o">+</span> <span class="n">magnet</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">magnet</span><span class="o">.</span><span class="n">magnet_label</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="mi">180</span> <span class="o">-</span> <span class="n">magnet</span><span class="o">.</span><span class="n">plot_orientation</span><span class="p">),</span><span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>  <span class="c1"># +&#39;\n&#39;+str(magnet.hexabundle)</span>


            <span class="n">ax_robot</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;mm&#39;</span><span class="p">)</span>
            <span class="n">ax_robot</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;mm&#39;</span><span class="p">)</span>
    <span class="c1">################################################################</span>

    <span class="c1">#plt.figure(1)</span>
    <span class="n">ax_hexa</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="n">ax_hexa</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">350</span><span class="p">,</span> <span class="mi">350</span><span class="p">])</span>
    <span class="n">ax_hexa</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">350</span><span class="p">,</span> <span class="mi">350</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">fig_hexa</span><span class="p">,</span> <span class="n">fig_robot</span></div>


<div class="viewcode-block" id="create_magnet_pickup_areas"><a class="viewcode-back" href="../../../../hop.hexabundle_allocation.problem_operations.html#hop.hexabundle_allocation.problem_operations.plots.create_magnet_pickup_areas">[docs]</a><span class="k">def</span> <span class="nf">create_magnet_pickup_areas</span><span class="p">(</span><span class="n">magnets</span><span class="p">):</span>

    <span class="k">for</span> <span class="n">magnet</span> <span class="ow">in</span> <span class="n">magnets</span><span class="p">:</span>
        <span class="n">magnet</span><span class="o">.</span><span class="n">create_pickup_areas</span><span class="p">()</span></div>

<div class="viewcode-block" id="draw_magnet_pickup_areas"><a class="viewcode-back" href="../../../../hop.hexabundle_allocation.problem_operations.html#hop.hexabundle_allocation.problem_operations.plots.draw_magnet_pickup_areas">[docs]</a><span class="k">def</span> <span class="nf">draw_magnet_pickup_areas</span><span class="p">(</span><span class="n">magnets</span><span class="p">,</span> <span class="n">colour</span><span class="p">):</span>

    <span class="k">for</span> <span class="n">magnet</span> <span class="ow">in</span> <span class="n">magnets</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">pickup_area</span> <span class="ow">in</span> <span class="n">magnet</span><span class="o">.</span><span class="n">pickup_areas</span><span class="p">:</span>
            <span class="n">pickup_area</span><span class="o">.</span><span class="n">draw_rectangle</span><span class="p">(</span><span class="n">colour</span><span class="p">)</span></div>

</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2022, Sam Vaughan.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.0.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>